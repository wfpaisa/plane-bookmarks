version: "3.8"

services:
  plane-bookmark:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5173:5173"  # Frontend (Vite)
      - "3001:3001"  # Backend (Express + WebSocket)
    volumes:
      - bookmark-data:/usr/src/app/server/data
    environment:
      # API URL - ruta relativa para que funcione con reverse proxy
      - VITE_API_URL=/api
      
      # ⚠️ NO CONFIGURAR VITE_SOCKET_URL
      # El sistema detecta automáticamente el dominio desde el navegador
      # Si estás en https://tu-dominio.com, se conectará a wss://tu-dominio.com/socket.io
      
      # Environment
      - NODE_ENV=production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    command: ["bun", "run", "dev"]

volumes:
  bookmark-data:
    driver: local
